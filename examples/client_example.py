#!/usr/bin/env python3\n\"\"\"\nExample client for the eRechnung PDF/A-3 XML Extractor API\n\nThis script demonstrates how to use the API to extract XML content from PDF files.\n\"\"\"\n\nimport requests\nimport sys\nimport json\nfrom pathlib import Path\n\ndef extract_xml_from_pdf(api_url: str, pdf_file_path: str) -> dict:\n    \"\"\"\n    Extract XML from a PDF file using the API\n    \n    Args:\n        api_url: Base URL of the API (e.g., http://localhost:8080)\n        pdf_file_path: Path to the PDF file to process\n        \n    Returns:\n        Dictionary containing the API response\n    \"\"\"\n    url = f\"{api_url}/extract_xml\"\n    \n    with open(pdf_file_path, 'rb') as f:\n        files = {'file': (Path(pdf_file_path).name, f, 'application/pdf')}\n        response = requests.post(url, files=files)\n    \n    return {\n        'status_code': response.status_code,\n        'response': response.json() if response.headers.get('content-type', '').startswith('application/json') else response.text\n    }\n\ndef check_health(api_url: str) -> dict:\n    \"\"\"\n    Check API health status\n    \n    Args:\n        api_url: Base URL of the API\n        \n    Returns:\n        Dictionary containing the health check response\n    \"\"\"\n    url = f\"{api_url}/health\"\n    response = requests.get(url)\n    \n    return {\n        'status_code': response.status_code,\n        'response': response.json() if response.headers.get('content-type', '').startswith('application/json') else response.text\n    }\n\ndef main():\n    api_url = \"http://127.0.0.1:8080\"\n    \n    # Check health first\n    print(\"Checking API health...\")\n    health = check_health(api_url)\n    print(f\"Health check: {json.dumps(health, indent=2)}\")\n    \n    if health['status_code'] != 200:\n        print(\"API is not healthy. Please start the server first.\")\n        sys.exit(1)\n    \n    # Extract XML from PDF if file path provided\n    if len(sys.argv) > 1:\n        pdf_path = sys.argv[1]\n        \n        if not Path(pdf_path).exists():\n            print(f\"Error: File {pdf_path} does not exist\")\n            sys.exit(1)\n            \n        print(f\"\\nExtracting XML from {pdf_path}...\")\n        result = extract_xml_from_pdf(api_url, pdf_path)\n        print(f\"Result: {json.dumps(result, indent=2)}\")\n        \n        # Save XML content if extraction was successful\n        if (result['status_code'] == 200 and \n            isinstance(result['response'], dict) and \n            'xml_content' in result['response']):\n            \n            xml_filename = result['response'].get('xml_filename', 'extracted.xml')\n            with open(xml_filename, 'w', encoding='utf-8') as f:\n                f.write(result['response']['xml_content'])\n            print(f\"\\nXML content saved to: {xml_filename}\")\n    else:\n        print(\"\\nUsage: python3 client_example.py <path_to_pdf_file>\")\n        print(\"Example: python3 client_example.py invoice.pdf\")\n\nif __name__ == \"__main__\":\n    main()\n